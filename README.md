# 草船借箭游戏开发项目

## 📖 项目概述

草船借箭是一款基于AI的互动文字冒险游戏，以三国时期的著名故事为背景，玩家将扮演诸葛亮，通过智谋和策略完成借箭的任务。

## 🚀 快速开始

### 本地运行

```bash
# 启动本地服务器
npm start

# 或使用Python
python3 -m http.server 8000
```

然后在浏览器中访问 http://localhost:8000

### 开发模式

```bash
npm run dev
```

## 🧪 测试与代码质量

### 运行自动化测试

```bash
# 在浏览器中运行数据流测试
npm run test:browser

# 或直接打开测试页面
open test-runner.html
```

### 代码一致性检查

```bash
# 运行代码一致性检查
npm run check

# 或直接运行脚本
node scripts/consistency-check.js
```

## 📁 项目结构

```
├── css/                # 样式文件
├── docs/               # 文档
│   └── 命名规范.md      # 代码命名规范文档
├── js/                 # JavaScript源代码
│   ├── core/           # 核心逻辑
│   │   ├── aiManager.js       # AI管理器
│   │   ├── gameEngine.js      # 游戏引擎
│   │   ├── gameStateManager.js # 游戏状态管理器
│   │   └── stateManager.js    # 状态管理器
│   ├── data/           # 游戏数据
│   │   └── gameData.js        # 游戏数据定义
│   ├── ui/             # 用户界面
│   │   └── uiManager.js       # UI管理器
│   ├── utils/          # 工具函数
│   │   ├── gameUtils.js       # 游戏工具函数
│   │   └── testUtils.js       # 测试工具函数
│   ├── main.js         # 主入口文件
│   ├── promptBuilder.js # AI提示词构建器
│   └── testTemplates.js # 测试模板
├── md/                 # Markdown文档
├── scripts/            # 脚本工具
│   └── consistency-check.js # 代码一致性检查脚本
├── tests/              # 测试文件
│   └── dataFlowTests.js      # 数据流测试
├── index.html          # 主页面
├── test-runner.html    # 测试运行器
├── package.json        # 项目配置
└── README.md           # 项目说明
```

## 📋 开发规范

### 命名规范

详细的命名规范请参考 [命名规范文档](./docs/命名规范.md)。

### 代码一致性

为确保代码一致性，请遵循以下原则：

1. **变量命名**：使用统一的变量命名方式，如角色属性必须通过角色对象访问
2. **函数调用**：使用模块化的函数调用方式，如 `GameUtils.parseValueChange`
3. **数据结构**：保持数据结构的一致性，不要创建重复或冗余的数据结构
4. **AI响应格式**：使用最新的AI响应格式，避免使用已废弃的字段

## 🔄 自动化测试

### 数据流测试

数据流测试用于验证代码一致性和数据流完整性，包括：

- 游戏状态结构一致性
- 角色属性命名一致性
- 事件数据一致性
- 道具数据一致性
- 数值变化一致性
- 条件检查一致性
- AI响应格式一致性

### 代码一致性检查

代码一致性检查用于自动化检查代码库中的命名一致性和数据流完整性，包括：

- 变量命名一致性
- 函数命名一致性
- 模块导入一致性
- 数据结构一致性
- 已废弃用法检查
- AI响应格式一致性

## 📝 开发流程

1. **需求分析**：理解需求，确定核心逻辑
2. **文档阅读**：阅读相关文档，了解历史Bug和解决方案
3. **代码分析**：分析涉及的文件和文件间的协同关系
4. **修改实施**：按照命名规范和代码一致性要求进行修改
5. **测试验证**：运行自动化测试和代码一致性检查
6. **代码审查**：确保代码符合规范，没有引入新的问题

## 🚫 常见陷阱

1. **AI响应解析**：确保promptBuilder生成的格式与gameEngine解析逻辑完全匹配
2. **状态同步**：stateManager的数据结构必须与gameData保持一致
3. **快速修复诱惑**：抵制"先让它跑起来"的冲动，确保根源修复

## 🎯 核心原则

- **预防优于修复**：通过文档学习避免重复错误
- **全局思维**：任何修改都要考虑系统影响
- **保持纯净**：宁可多改几个文件，不要添加转换层
- **一次做对**：不要想着"以后再重构"

记住：**每一行代码都应该有存在的必要性！**