# è‰èˆ¹å€Ÿç®­æ¸¸æˆ - ä»£ç å‘½åè§„èŒƒ

## ğŸ“‹ ç›®çš„

æœ¬æ–‡æ¡£å»ºç«‹ç»Ÿä¸€çš„ä»£ç å‘½åè§„èŒƒï¼Œç¡®ä¿ä»£ç åº“ä¸­å˜é‡ã€å‡½æ•°ã€æ¨¡å—ç­‰å‘½åçš„ä¸€è‡´æ€§ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **ä¸€è‡´æ€§ä¼˜å…ˆ**ï¼šåŒä¸€æ¦‚å¿µåœ¨æ‰€æœ‰æ–‡ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„å‘½å
2. **è¯­ä¹‰æ˜ç¡®**ï¼šå‘½ååº”æ¸…æ™°è¡¨è¾¾å…¶ç”¨é€”å’Œå«ä¹‰
3. **é¿å…æ­§ä¹‰**ï¼šä¸ä½¿ç”¨å®¹æ˜“æ··æ·†çš„ç›¸ä¼¼å‘½å
4. **éµå¾ªçº¦å®š**ï¼šç¬¦åˆJavaScriptå’Œé¡¹ç›®çš„å‘½åçº¦å®š

## ğŸ“ å˜é‡å‘½åè§„èŒƒ

### æ¸¸æˆçŠ¶æ€å˜é‡

#### è§’è‰²å±æ€§ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨è§’è‰²å¯¹è±¡è®¿é—®
state.zhouYu.suspicion     // å‘¨ç‘œçŒœå¿Œå€¼
state.luSu.trust          // é²è‚ƒä¿¡ä»»å€¼
state.ganNing.alertness   // ç”˜å®æœºè­¦å€¼
state.zhugeLiang.intelligence  // è¯¸è‘›äº®æ™ºè°‹å€¼
state.zhugeLiang.eloquence     // è¯¸è‘›äº®å£æ‰å€¼
state.zhugeLiang.stamina       // è¯¸è‘›äº®ä½“åŠ›å€¼

// âŒ é”™è¯¯ï¼šç›´æ¥è®¿é—®ï¼ˆå·²åºŸå¼ƒï¼‰
state.suspicion
state.trust
state.zhouYuAlert    // æ—§å˜é‡åï¼Œå·²åºŸå¼ƒ
state.luSuTrust      // æ—§å˜é‡åï¼Œå·²åºŸå¼ƒ
```

#### æ¸¸æˆè¿›åº¦å˜é‡
```javascript
state.timeProgress        // æ—¶é—´è¿›åº¦ï¼ˆ1-3æ—¥ï¼‰
state.arrows             // ç®­çŸ¢æ•°é‡
state.preparationProgress // å‡†å¤‡è¿›åº¦
state.dangerLevel        // å±é™©ç­‰çº§
state.soldierMorale      // å£«å…µå£«æ°”
state.shipLoss           // èˆ¹åªæŸå¤±
```

#### äº‹ä»¶çŠ¶æ€å˜é‡
```javascript
state.events.convinceLuSu     // è¯´æœé²è‚ƒäº‹ä»¶
state.events.meetGanNing      // é‡è§ç”˜å®äº‹ä»¶
state.events.borrowArrows     // å€Ÿç®­äº‹ä»¶
```

### å±æ€§æ˜¾ç¤ºåæ˜ å°„ï¼ˆç»Ÿä¸€é…ç½®ï¼‰
```javascript
// åœ¨ gameData.js ä¸­ç»Ÿä¸€å®šä¹‰
const ATTRIBUTE_DISPLAY_NAMES = {
  intelligence: "æ™ºè°‹å€¼",
  suspicion: "çŒœå¿Œå€¼",
  trust: "ä¿¡ä»»å€¼",
  alertness: "æœºè­¦å€¼",
  eloquence: "å£æ‰å€¼",
  stamina: "ä½“åŠ›å€¼"
};
```

## ğŸ”§ å‡½æ•°å‘½åè§„èŒƒ

### å·¥å…·å‡½æ•°ï¼ˆç»Ÿä¸€ä½¿ç”¨ GameUtilsï¼‰
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»Ÿä¸€å·¥å…·ç±»
GameUtils.parseValueChange(value)
GameUtils.checkCondition(condition, evaluator)
GameUtils.clampValue(value, min, max)
GameUtils.deepClone(obj)
GameUtils.formatText(text, variables)
GameUtils.generateId()
GameUtils.debugLog(message, data)

// âŒ é”™è¯¯ï¼šç›´æ¥è°ƒç”¨åŸæ–¹æ³•
this.parseValueChange(value)  // åº”ä½¿ç”¨ GameUtils
this.checkCondition(condition) // åº”ä½¿ç”¨ GameUtils
```

### çŠ¶æ€ç®¡ç†å‡½æ•°
```javascript
// StateManager ç±»æ–¹æ³•
applyValueChanges(changes)    // åº”ç”¨æ•°å€¼å˜åŒ–
getState()                   // è·å–å½“å‰çŠ¶æ€
resetState()                 // é‡ç½®çŠ¶æ€
addDialogue(speaker, content, type) // æ·»åŠ å¯¹è¯å†å²
addItem(itemId)              // æ·»åŠ é“å…·
removeItem(itemId)           // ç§»é™¤é“å…·
```

### äº‹ä»¶å¤„ç†å‡½æ•°
```javascript
// GameEngine ç±»æ–¹æ³•
handleSpecialProgress(progress)     // å¤„ç†ç‰¹æ®Šè¿›åº¦
handleEventSuggestion(suggestion)   // å¤„ç†äº‹ä»¶å»ºè®®
handleItemGrant(itemGrant)          // å¤„ç†é“å…·æˆäºˆ
registerEventHandler(eventId, handler) // æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
triggerEvent(eventId, context)      // è§¦å‘äº‹ä»¶
```

## ğŸ“ æ–‡ä»¶å’Œæ¨¡å—å‘½åè§„èŒƒ

### ç›®å½•ç»“æ„
```
js/
â”œâ”€â”€ core/           # æ ¸å¿ƒé€»è¾‘æ¨¡å—
â”‚   â”œâ”€â”€ stateManager.js
â”‚   â”œâ”€â”€ gameEngine.js
â”‚   â”œâ”€â”€ aiManager.js
â”‚   â””â”€â”€ gameStateManager.js
â”œâ”€â”€ data/           # æ•°æ®å®šä¹‰æ¨¡å—
â”‚   â””â”€â”€ gameData.js
â”œâ”€â”€ ui/             # ç”¨æˆ·ç•Œé¢æ¨¡å—
â”‚   â””â”€â”€ uiManager.js
â”œâ”€â”€ utils/          # å·¥å…·ç±»æ¨¡å—
â”‚   â”œâ”€â”€ gameUtils.js
â”‚   â””â”€â”€ testUtils.js
â”œâ”€â”€ main.js         # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ promptBuilder.js # æç¤ºè¯æ„å»º
â””â”€â”€ testTemplates.js # æµ‹è¯•æ¨¡æ¿
```

### å¯¼å…¥å¯¼å‡ºè§„èŒƒ
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¿æŒä¸€è‡´æ€§
import { StateManager } from './core/stateManager.js';
import { GameUtils } from './utils/gameUtils.js';
import { characters } from '../data/gameData.js';

// âœ… æ­£ç¡®ï¼šç»Ÿä¸€çš„å¯¼å‡ºæ–¹å¼
export class StateManager { /* ... */ }
export { StateManager };
export default StateManager;
```

## ğŸŒ å…¨å±€å˜é‡å‘½åè§„èŒƒ

### Window å¯¹è±¡æš´éœ²ï¼ˆç»Ÿä¸€æ ‡å‡†ï¼‰
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»Ÿä¸€çš„å…¨å±€å˜é‡å
window.gameInstance = gameInstance;  // ä¸»æ¸¸æˆå®ä¾‹

// âœ… æ­£ç¡®ï¼šæµ‹è¯•ç›¸å…³å…¨å±€å‡½æ•°
window.testAIResponse = function(jsonString) { /* ... */ };
window.quickTest = function(templateName) { /* ... */ };
window.debugGameState = function() { /* ... */ };

// âœ… æ­£ç¡®ï¼šUIäº¤äº’å…¨å±€å‡½æ•°
window.sendMessage = function() { /* ... */ };
window.selectItem = function(itemName) { /* ... */ };
window.selectEventChoice = function(eventId, choiceIndex) { /* ... */ };

// âŒ é”™è¯¯ï¼šé‡å¤æš´éœ²
window.game = gameInstance;  // ä¸ gameInstance é‡å¤
```

## ğŸ¨ CSS ç±»åè§„èŒƒ

### ç»„ä»¶ç±»å
```css
/* æ¸¸æˆå®¹å™¨ */
.game-container
.status-bar
.character-avatars
.dialogue-area

/* çŠ¶æ€ç›¸å…³ */
.status-item
.status-value
.value-change-animation

/* äº‹ä»¶ç›¸å…³ */
.event-overlay
.event-dialog
.event-choice
.choice-button

/* é“å…·ç›¸å…³ */
.item-option
.item-notification
.item-effect
```

## ğŸ“Š æ•°æ®ç»“æ„å‘½åè§„èŒƒ

### äº‹ä»¶æ•°æ®ç»“æ„
```javascript
// å¯¹è¯äº‹ä»¶
dialogue_event1, dialogue_event2, ...

// æŠ‰æ‹©äº‹ä»¶
choice_event1, choice_event2, ...

// æ£€å®šäº‹ä»¶
check_event1, check_event2, ...

// çªå‘äº‹ä»¶
emergency_event1, emergency_event2, ...
```

### é“å…·IDå‘½å
```javascript
// ä½¿ç”¨é©¼å³°å‘½åæ³•
xuanDeBrush      // ç„å¾·æ¯›ç¬”
dongwuTiger      // ä¸œå´è™ç¬¦
warDrum          // æˆ˜é¼“
grassman         // è‰äºº
ironChain        // é“é“¾
```

## âš ï¸ å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•

### 1. å˜é‡åä¸ä¸€è‡´
```javascript
// âŒ é”™è¯¯ï¼šåœ¨ä¸åŒæ–‡ä»¶ä¸­ä½¿ç”¨ä¸åŒçš„å˜é‡å
// æ–‡ä»¶A
state.zhouYuAlert
// æ–‡ä»¶B  
state.suspicion

// âœ… æ­£ç¡®ï¼šç»Ÿä¸€ä½¿ç”¨æ–°çš„å˜é‡å
state.zhouYu.suspicion
```

### 2. å‡½æ•°è°ƒç”¨ä¸ç»Ÿä¸€
```javascript
// âŒ é”™è¯¯ï¼šæ··ç”¨ä¸åŒçš„è°ƒç”¨æ–¹å¼
this.parseValueChange(value);        // ç›´æ¥è°ƒç”¨
GameUtils.parseValueChange(value);   // å·¥å…·ç±»è°ƒç”¨

// âœ… æ­£ç¡®ï¼šç»Ÿä¸€ä½¿ç”¨å·¥å…·ç±»
GameUtils.parseValueChange(value);
```

### 3. è·¯å¾„å¼•ç”¨ä¸ä¸€è‡´
```javascript
// âŒ é”™è¯¯ï¼šè·¯å¾„å†™æ³•ä¸ç»Ÿä¸€
import { StateManager } from './core/stateManager.js';
import { GameUtils } from '../utils/gameUtils.js';

// âœ… æ­£ç¡®ï¼šä¿æŒç›¸å¯¹è·¯å¾„çš„ä¸€è‡´æ€§
import { StateManager } from './core/stateManager.js';
import { GameUtils } from './utils/gameUtils.js';
```

## ğŸ” æ£€æŸ¥æ¸…å•

### æ–°å¢åŠŸèƒ½æ—¶çš„æ£€æŸ¥é¡¹
- [ ] å˜é‡å‘½åæ˜¯å¦ç¬¦åˆè§„èŒƒ
- [ ] å‡½æ•°å‘½åæ˜¯å¦ä¸€è‡´
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç»Ÿä¸€çš„å·¥å…·ç±»
- [ ] å¯¼å…¥è·¯å¾„æ˜¯å¦è§„èŒƒ
- [ ] å…¨å±€å˜é‡æ˜¯å¦å¿…è¦ä¸”å‘½ååˆç†
- [ ] CSSç±»åæ˜¯å¦éµå¾ªçº¦å®š

### ä»£ç å®¡æŸ¥æ—¶çš„æ£€æŸ¥é¡¹
- [ ] æ˜¯å¦å­˜åœ¨é‡å¤çš„å˜é‡å®šä¹‰
- [ ] æ˜¯å¦æœ‰åºŸå¼ƒçš„å˜é‡åä»åœ¨ä½¿ç”¨
- [ ] å‡½æ•°è°ƒç”¨æ˜¯å¦ç»Ÿä¸€
- [ ] æ•°æ®è®¿é—®è·¯å¾„æ˜¯å¦ä¸€è‡´
- [ ] æ˜¯å¦æœ‰ä¸å¿…è¦çš„å…¨å±€å˜é‡æš´éœ²

## ğŸ“š å‚è€ƒèµ„æº

- [JavaScript å‘½åçº¦å®š](https://developer.mozilla.org/en-US/docs/MDN/Guidelines/Code_guidelines/JavaScript#naming_conventions)
- [é¡¹ç›® Debugæ‰‹å†Œ](../md/Debugæ‰‹å†Œ.md)
- [ä»£ç åŒæ­¥ä¿®æ”¹æŒ‡å—](../md/Debugæ‰‹å†Œ.md#ä»£ç åŒæ­¥ä¿®æ”¹æŒ‡å—)

---

**æ³¨æ„**ï¼šæœ¬è§„èŒƒæ˜¯æ´»æ–‡æ¡£ï¼Œéšç€é¡¹ç›®å‘å±•ä¼šæŒç»­æ›´æ–°ã€‚æ‰€æœ‰å›¢é˜Ÿæˆå‘˜éƒ½åº”éµå¾ªæ­¤è§„èŒƒï¼Œå¹¶åœ¨å‘ç°é—®é¢˜æ—¶åŠæ—¶æ›´æ–°æ–‡æ¡£ã€‚