# 草船借箭游戏 - 代码命名规范

## 📋 目的

本文档建立统一的代码命名规范，确保代码库中变量、函数、模块等命名的一致性，提升代码可维护性和团队协作效率。

## 🎯 核心原则

1. **一致性优先**：同一概念在所有文件中使用相同的命名
2. **语义明确**：命名应清晰表达其用途和含义
3. **避免歧义**：不使用容易混淆的相似命名
4. **遵循约定**：符合JavaScript和项目的命名约定

## 📝 变量命名规范

### 游戏状态变量

#### 角色属性（统一格式）
```javascript
// ✅ 正确：使用角色对象访问
state.zhouYu.suspicion     // 周瑜猜忌值
state.luSu.trust          // 鲁肃信任值
state.ganNing.alertness   // 甘宁机警值
state.zhugeLiang.intelligence  // 诸葛亮智谋值
state.zhugeLiang.eloquence     // 诸葛亮口才值
state.zhugeLiang.stamina       // 诸葛亮体力值

// ❌ 错误：直接访问（已废弃）
state.suspicion
state.trust
state.zhouYuAlert    // 旧变量名，已废弃
state.luSuTrust      // 旧变量名，已废弃
```

#### 游戏进度变量
```javascript
state.timeProgress        // 时间进度（1-3日）
state.arrows             // 箭矢数量
state.preparationProgress // 准备进度
state.dangerLevel        // 危险等级
state.soldierMorale      // 士兵士气
state.shipLoss           // 船只损失
```

#### 事件状态变量
```javascript
state.events.convinceLuSu     // 说服鲁肃事件
state.events.meetGanNing      // 遇见甘宁事件
state.events.borrowArrows     // 借箭事件
```

### 属性显示名映射（统一配置）
```javascript
// 在 gameData.js 中统一定义
const ATTRIBUTE_DISPLAY_NAMES = {
  intelligence: "智谋值",
  suspicion: "猜忌值",
  trust: "信任值",
  alertness: "机警值",
  eloquence: "口才值",
  stamina: "体力值"
};
```

## 🔧 函数命名规范

### 工具函数（统一使用 GameUtils）
```javascript
// ✅ 正确：使用统一工具类
GameUtils.parseValueChange(value)
GameUtils.checkCondition(condition, evaluator)
GameUtils.clampValue(value, min, max)
GameUtils.deepClone(obj)
GameUtils.formatText(text, variables)
GameUtils.generateId()
GameUtils.debugLog(message, data)

// ❌ 错误：直接调用原方法
this.parseValueChange(value)  // 应使用 GameUtils
this.checkCondition(condition) // 应使用 GameUtils
```

### 状态管理函数
```javascript
// StateManager 类方法
applyValueChanges(changes)    // 应用数值变化
getState()                   // 获取当前状态
resetState()                 // 重置状态
addDialogue(speaker, content, type) // 添加对话历史
addItem(itemId)              // 添加道具
removeItem(itemId)           // 移除道具
```

### 事件处理函数
```javascript
// GameEngine 类方法
handleSpecialProgress(progress)     // 处理特殊进度
handleEventSuggestion(suggestion)   // 处理事件建议
handleItemGrant(itemGrant)          // 处理道具授予
registerEventHandler(eventId, handler) // 注册事件处理器
triggerEvent(eventId, context)      // 触发事件
```

## 📁 文件和模块命名规范

### 目录结构
```
js/
├── core/           # 核心逻辑模块
│   ├── stateManager.js
│   ├── gameEngine.js
│   ├── aiManager.js
│   └── gameStateManager.js
├── data/           # 数据定义模块
│   └── gameData.js
├── ui/             # 用户界面模块
│   └── uiManager.js
├── utils/          # 工具类模块
│   ├── gameUtils.js
│   └── testUtils.js
├── main.js         # 主入口文件
├── promptBuilder.js # 提示词构建
└── testTemplates.js # 测试模板
```

### 导入导出规范
```javascript
// ✅ 正确：使用相对路径，保持一致性
import { StateManager } from './core/stateManager.js';
import { GameUtils } from './utils/gameUtils.js';
import { characters } from '../data/gameData.js';

// ✅ 正确：统一的导出方式
export class StateManager { /* ... */ }
export { StateManager };
export default StateManager;
```

## 🌐 全局变量命名规范

### Window 对象暴露（统一标准）
```javascript
// ✅ 正确：使用统一的全局变量名
window.gameInstance = gameInstance;  // 主游戏实例

// ✅ 正确：测试相关全局函数
window.testAIResponse = function(jsonString) { /* ... */ };
window.quickTest = function(templateName) { /* ... */ };
window.debugGameState = function() { /* ... */ };

// ✅ 正确：UI交互全局函数
window.sendMessage = function() { /* ... */ };
window.selectItem = function(itemName) { /* ... */ };
window.selectEventChoice = function(eventId, choiceIndex) { /* ... */ };

// ❌ 错误：重复暴露
window.game = gameInstance;  // 与 gameInstance 重复
```

## 🎨 CSS 类名规范

### 组件类名
```css
/* 游戏容器 */
.game-container
.status-bar
.character-avatars
.dialogue-area

/* 状态相关 */
.status-item
.status-value
.value-change-animation

/* 事件相关 */
.event-overlay
.event-dialog
.event-choice
.choice-button

/* 道具相关 */
.item-option
.item-notification
.item-effect
```

## 📊 数据结构命名规范

### 事件数据结构
```javascript
// 对话事件
dialogue_event1, dialogue_event2, ...

// 抉择事件
choice_event1, choice_event2, ...

// 检定事件
check_event1, check_event2, ...

// 突发事件
emergency_event1, emergency_event2, ...
```

### 道具ID命名
```javascript
// 使用驼峰命名法
xuanDeBrush      // 玄德毛笔
dongwuTiger      // 东吴虎符
warDrum          // 战鼓
grassman         // 草人
ironChain        // 铁链
```

## ⚠️ 常见错误和避免方法

### 1. 变量名不一致
```javascript
// ❌ 错误：在不同文件中使用不同的变量名
// 文件A
state.zhouYuAlert
// 文件B  
state.suspicion

// ✅ 正确：统一使用新的变量名
state.zhouYu.suspicion
```

### 2. 函数调用不统一
```javascript
// ❌ 错误：混用不同的调用方式
this.parseValueChange(value);        // 直接调用
GameUtils.parseValueChange(value);   // 工具类调用

// ✅ 正确：统一使用工具类
GameUtils.parseValueChange(value);
```

### 3. 路径引用不一致
```javascript
// ❌ 错误：路径写法不统一
import { StateManager } from './core/stateManager.js';
import { GameUtils } from '../utils/gameUtils.js';

// ✅ 正确：保持相对路径的一致性
import { StateManager } from './core/stateManager.js';
import { GameUtils } from './utils/gameUtils.js';
```

## 🔍 检查清单

### 新增功能时的检查项
- [ ] 变量命名是否符合规范
- [ ] 函数命名是否一致
- [ ] 是否使用了统一的工具类
- [ ] 导入路径是否规范
- [ ] 全局变量是否必要且命名合理
- [ ] CSS类名是否遵循约定

### 代码审查时的检查项
- [ ] 是否存在重复的变量定义
- [ ] 是否有废弃的变量名仍在使用
- [ ] 函数调用是否统一
- [ ] 数据访问路径是否一致
- [ ] 是否有不必要的全局变量暴露

## 📚 参考资源

- [JavaScript 命名约定](https://developer.mozilla.org/en-US/docs/MDN/Guidelines/Code_guidelines/JavaScript#naming_conventions)
- [项目 Debug手册](../md/Debug手册.md)
- [代码同步修改指南](../md/Debug手册.md#代码同步修改指南)

---

**注意**：本规范是活文档，随着项目发展会持续更新。所有团队成员都应遵循此规范，并在发现问题时及时更新文档。